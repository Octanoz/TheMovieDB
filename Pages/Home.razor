@page "/"
@inject TMDBClient TMDB
@using MudBlazor

<PageTitle>Home</PageTitle>

<MudBreakpointProvider OnBreakpointChanged="OnBreakpointChanged">
    <MudHidden Breakpoint="Breakpoint.MdAndUp" Invert="true">
        <MudText Typo="Typo.h3" Class="ma-6">Popular Movies</MudText>
    </MudHidden>
</MudBreakpointProvider>
<MudBreakpointProvider>
    <MudHidden Breakpoint="Breakpoint.MdAndUp">
        <MudText Typo="Typo.h4" Class="ma-6">Popular Movies</MudText>
    </MudHidden>
</MudBreakpointProvider>

@if (popularMovies is not null)
{
    <MudGrid Spacing="6" Class="px-12">
        @foreach(var movie in popularMovies.Results)
        {
            <MudItem xs="12" sm="6" md="4" lg="3" xl="2">
                <MudContainer Class="px-0" Style="width: min(105%, 342px);">
                    <MudPaper Elevation="5" Class="mud-theme-secondary d-flex align-center justify-center mud-width-full rounded-lg pa-3">
                        @if (isSmallScreen)
                        {
                            <PopularMovieCardLandscape Movie="@movie" />
                        }
                        else
                        {
                            <PopularMovieCard Movie="@movie" />
                        }
                    </MudPaper>
                </MudContainer>
            </MudItem>
        }
    </MudGrid>
}
else
{
    @for (int i = 0; i < 10; i++)
    {
        <MudCard>
            <MudSkeleton SkeletonType="SkeletonType.Rectangle" Height="200" />
            <MudCardContent>
                <MudSkeleton Class="mx-auto" Width="30%" Height="40px" />
                <MudSkeleton Width="80%" />
                <MudSkeleton Width="100%" />
            </MudCardContent>
        </MudCard>
    }
}

@code {
    PopularMoviesPagedResponse? popularMovies;
    bool isSmallScreen = false;

    private void OnBreakpointChanged(Breakpoint breakpoint)
    {
        isSmallScreen = breakpoint <= Breakpoint.Sm;
        StateHasChanged();
    }

    protected override async Task OnInitializedAsync()
    {
        popularMovies = await TMDB.GetPopularMoviesPagedResponseAsync();
    }
}